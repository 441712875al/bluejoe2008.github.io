<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>RelationFinder</title>
    <script type="text/javascript" src="../dist/grapheco-browser.min.js"></script>
    <link type="text/css" rel="stylesheet" href="../dist/grapheco-browser.min.css">
    <script src="./lib/jquery-3.2.1/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet" href="./lib/jquery-3.2.1/jquery-ui.css">
    <script src="./lib/jquery-3.2.1/jquery-ui.js"></script>
    <link href="./lib/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style type="text/css">
        body {
            margin: 0px;
            font-size: 14px;
        }

        #graphArea {
            height: 100%;
            border: 1px solid lightgray;
        }
    </style>

</head>

<body>
<div style="height:92%">
    <div id="graphArea"></div>
</div>
<div style="margin-top:10px">
    <div>
        <div style="width:150px;float: left;">
            <input id="findRelations" type="button" style="height: 30px;background-color: dodgerblue;color: white;"
                   value="find relations">
            <input id="stopQuery" type="button" value="stop"
                   style="height: 30px;background-color: orangered;color: white;">
        </div>
        <div style="width:600px;float: left;">
            <div style="width:200px;float:left;">
                <label for="spinner">maxdepth:</label>
                <input id="spinner" size="2" name="value" value="3">
            </div>
            <div style="width:200px;float:left;" id="slider"></div>
            <div style="float:right">
                <label for="amount">refresh interval:</label>
                <input type="text" size="8" id="amount" readonly style="border:0; color:#f6931f; font-weight:bold;">
            </div>
        </div>
    </div>
    <script type="text/javascript">
        grapheco.i18n.setLanguage("chs");

        var browser = new grapheco.GraphBrowser(
                grapheco.GraphRAM.fromGsonFile("honglou.json"),
                document.getElementById('graphArea'), {
                    enableRelFinderCtrl: true,
                    showGraphOptions: {
                        showLabels: true,
                        showFaces: true,
                        showDegrees: true,
                        showEdges: true,
                        showGroups: true
                    }
                });

        browser.updateTheme(function (theme) {
            theme.networkOptions.edges.physics = false;
            theme.networkOptions.edges.length = 0.5;
            theme.networkOptions.physics.timestep = 0.1;
        });

        console.log(browser);
        var selectedNodes = [];
        var nodeIds = [];
        //use async.series to make serial calls
        browser.pipe([
            function (callback) {
                browser.init(callback);
            },

            function (callback) {
                browser.search([{label: "贾宝玉"}, {label: "薛蟠"}], function (nodes) {
                    selectedNodes = nodes;
                    browser.insertNodes(nodes);
                    nodeIds = selectedNodes.map(function (node) {
                        return node.id;
                    });
                    browser.placeNodes(nodeIds);
                    browser._nodes.update(nodeIds.map(function (nodeId) {
                        return {id: nodeId, physics: false};
                    }));
                    callback();
                });
            }
        ]);

        $("#findRelations").click(function () {
            browser.deleteNodes(function (node) {
                return nodeIds.indexOf(node.id) < 0;
            });

            browser.ctrlRelFinder.startQuery(nodeIds, $("#slider").slider("value"),
                    $("#spinner").val());
        });

        $("#slider").slider({
            value: 500,
            min: 50,
            max: 10000,
            slide: function (event, ui) {
                $("#amount").val(ui.value + "ms");
            }
        });

        $("#spinner").spinner({
            min: 1,
        });

        $("#amount").val("" + $("#slider").slider("value") + "ms");
        $("#stopQuery").click(function () {
            browser.ctrlRelFinder.stopQuery();
        });
    </script>
</body>

</html>